---
title: "P8103 Homework 3"
author: "Adina Zhang"
duedate: "October 15, 2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
  fig.width = 6,
  fig.asp = .6,
  out.width = "100%")

library(dplyr)
library(p8105.datasets)
library(ggplot2)

theme_set(theme_bw() + theme(legend.position = "bottom"))
```

## Problem 1

#### Set up BRFSS dataset

```{r BRFSS_df}
# Load and clean BRFSS dataset
brfss_df = brfss_smart2010 %>% 
  janitor::clean_names() %>% 
  filter(topic == "Overall Health") %>% 
  select(year, locationabbr, locationdesc, response, data_value) %>% 
  mutate(response = factor(response,
                           levels = c("Excellent", "Very good", "Good", "Fair", "Poor"))) 

brfss_df
```

#### Subset the dataset into number of locations per state in 2002

```{r count_location}
# Subset brfss dataset to count number of locations in each state
filter(brfss_df, year == 2002) %>% 
  distinct(locationabbr, locationdesc) %>% 
  group_by(locationabbr) %>% 
  count() %>% 
  filter(n == 7) %>% 
  knitr::kable()
  
```

In 2002, there were three states (CT, FL, and NC) that observed seven locations. 

#### Spaghetti plot

```{r spaghetti_plot}
# Separate dataset into spaghetti plot variables
spaghetti_plot = brfss_df %>% 
  distinct(locationabbr, locationdesc, year) %>% 
  group_by(locationabbr, year) %>% 
  summarize(n = n())

# Create spaghetti_plot 
spaghetti_plot %>% 
  ggplot(aes(x = year, y = n)) +
  geom_line(aes(color = locationabbr)) +
  viridis::scale_color_viridis(
    name = "Location", 
    discrete = TRUE
  ) + 
  labs(
    title = "Number of locations in each state, 2002-2010",
    x = "Year",
    y = "Number of Locations",
    caption = "BRFSS Dataset"
  ) + 
  theme(legend.position = "right")

```

#### Descriptive variables for "Excellent" proportions in 2002, 2006, and 2010

```{r brfss_table}
# Summarize descriptive variables to make a table
brfss_df %>% 
  filter(year %in% c(2002, 2006, 2010), response == "Excellent") %>% 
  group_by(year) %>% 
  summarize(mean_excellent = mean(data_value, na.rm = TRUE),
            std_excellent = sd(data_value, na.rm = TRUE)) %>% 
  knitr::kable()
```

#### Five-panel plot, distribution of responses

```{r response_df}
# Summarize average proportions of each response 
response_df = brfss_df %>% 
  group_by(year, locationabbr, response) %>% 
  summarize(mean_prop = mean(data_value, na.rm = TRUE))

# Plot distributions in five panels
response_df %>% 
  ggplot(aes(x = year, y = mean_prop)) + 
  geom_point() + 
  facet_grid(.~response) +
  scale_x_continuous(breaks = c(2002, 2006, 2010),
                     limits = c(2000, 2012)) + 
  labs(
    title = "Distribution of state-level response proportions, 2002-2010",
    x = "Year",
    y = "State level averages",
    caption = "BRFSS dataset"
  )

```

## Problem 2

#### Instacart summary

```{r instacart_df}
# Load instacard
instacart_df = instacart

instacart_df
```

Instacart is an online grocery shopping company, and the instacard dataset contains information on online grocery orders from their customers. The instacart dataset includes `r nrow(instacart_df)` observations and `r ncol(instacart_df)` variables. Some of these key variables include product name, food aisle information (name, number, department), time or order (day of the week, hour of the day, days since last ordered). For example, there are `r nrow(distinct(instacart_df, instacart_df$department))` departments which range from snacks, frozen foods, to dairy and eggs... 

#### Aisle information

There are `r nrow(distinct(instacart_df, aisle))` aisles in this dataset. Some examples of these include yogurt, fresh vegetables, and specialty cheeses. The aisle with the most counts of order. Most items are ordered from the fresh vegetable, fresh fruit, and packaged vegetables and fruits aisles. 
 
```{r aisle_count}
# Group by aisles and summarize counts
aisle_count = instacart_df %>% 
  group_by(aisle) %>% 
  summarize(n = n()) %>% 
  arrange(desc(n)) 
  
aisle_count
```

```{r plot_aisle_count}
# Plot distribution of items ordered from each aisle
ggplot(aisle_count, aes(x = reorder(aisle, order(n, decreasing = TRUE)), y = n)) +
  geom_bar(stat = "identity") + 
  labs(
    title = "Number of items ordered from each aisle",
    x = "Aisle Names",
    y = "N",
    caption = "Instacart Data"
  ) + 
  theme(axis.ticks = element_blank(), 
        legend.position = "none",
        axis.text.x = element_text(size = 3, angle = 290))
```


## Problem 3






